<div class="product-form-container">
    <div class="header">
        <h1>{{ isEditing ? 'Edit Product' : 'New Product' }}</h1>
        <button class="back-button" routerLink="../">
      <i class="fas fa-arrow-left"></i> Back to Products
    </button>
    </div>

    <form [formGroup]="productForm" (ngSubmit)="onSubmit()" *ngIf="!isLoading">
        <div class="form-grid">
            <!-- Basic Information -->
            <div class="form-section">
                <h2>Basic Information</h2>

                <div class="form-group">
                    <label for="name">Product Name *</label>
                    <input id="name" type="text" formControlName="name" [class.error]="submitted && productForm.get('name')?.errors">
                    <div class="error-message" *ngIf="submitted && productForm.get('name')?.errors">
                        <span *ngIf="productForm.get('name')?.errors?.['required']">Name is required</span>
                        <span *ngIf="productForm.get('name')?.errors?.['minlength']">Name must be at least 3 characters</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="sku">SKU *</label>
                    <input id="sku" type="text" formControlName="sku" [class.error]="submitted && productForm.get('sku')?.errors">
                    <div class="error-message" *ngIf="submitted && productForm.get('sku')?.errors">
                        <span *ngIf="productForm.get('sku')?.errors?.['required']">SKU is required</span>
                        <span *ngIf="productForm.get('sku')?.errors?.['pattern']">SKU must contain only uppercase letters and numbers</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" formControlName="description" rows="4" [class.error]="submitted && productForm.get('description')?.errors"></textarea>
                    <div class="error-message" *ngIf="submitted && productForm.get('description')?.errors">
                        <span *ngIf="productForm.get('description')?.errors?.['required']">Description is required</span>
                        <span *ngIf="productForm.get('description')?.errors?.['minlength']">Description must be at least 20 characters</span>
                    </div>
                </div>
            </div>

            <!-- Pricing and Inventory -->
            <div class="form-section">
                <h2>Pricing & Inventory</h2>

                <div class="form-group">
                    <label for="price">Price ($) *</label>
                    <input id="price" type="number" step="0.01" formControlName="price" [class.error]="submitted && productForm.get('price')?.errors">
                    <div class="error-message" *ngIf="submitted && productForm.get('price')?.errors">
                        <span *ngIf="productForm.get('price')?.errors?.['required']">Price is required</span>
                        <span *ngIf="productForm.get('price')?.errors?.['min']">Price must be greater than 0</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="category">Category *</label>
                    <select id="category" formControlName="category" [class.error]="submitted && productForm.get('category')?.errors">
            <option value="">Select a category</option>
            <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
          </select>
                    <div class="error-message" *ngIf="submitted && productForm.get('category')?.errors?.['required']">
                        Category is required
                    </div>
                </div>

                <div class="form-group-row">
                    <div class="form-group">
                        <label for="stock">Current Stock *</label>
                        <input id="stock" type="number" formControlName="stock" [class.error]="submitted && productForm.get('stock')?.errors">
                    </div>

                    <div class="form-group">
                        <label for="minStock">Minimum Stock *</label>
                        <input id="minStock" type="number" formControlName="minStock" [class.error]="submitted && productForm.get('minStock')?.errors">
                    </div>
                </div>
            </div>

            <!-- Images -->
            <div class="form-section">
                <h2>Product Images</h2>

                <div class="image-upload-container">
                    <div class="image-preview" *ngFor="let image of imagePreview; let i = index">
                        <img [src]="image" alt="Product preview">
                        <button aria-label="button" type="button" class="remove-image" (click)="removeImage(i)">
              <i class="fas fa-times"></i>
            </button>
                    </div>

                    <div class="upload-box" *ngIf="imagePreview.length < 5">
                        <input type="file" accept="image/*" (change)="onImageUpload($event)" #fileInput hidden>
                        <button type="button" (click)="fileInput.click()">
              <i class="fas fa-cloud-upload-alt"></i>
              <span>Upload Image</span>
            </button>
                    </div>
                </div>
            </div>

            <!-- Specifications -->
            <div class="form-section">
                <h2>
                    Specifications
                    <button type="button" class="add-spec-button" (click)="addSpecification()">
            <i class="fas fa-plus"></i> Add Specification
          </button>
                </h2>

                <div formArrayName="specifications">
                    <div class="spec-row" *ngFor="let spec of productForm.get('specifications').controls; let i = index" [formGroupName]="i">
                        <input type="text" formControlName="key" placeholder="Key">
                        <input type="text" formControlName="value" placeholder="Value">
                        <button aria-label="button" type="button" class="remove-spec" (click)="removeSpecification(i)">
              <i class="fas fa-trash"></i>
            </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-footer">
            <div class="status-toggle">
                <label>Product Status:</label>
                <div class="toggle-group">
                    <input type="radio" id="active" value="active" formControlName="status">
                    <label for="active">Active</label>

                    <input type="radio" id="inactive" value="inactive" formControlName="status">
                    <label for="inactive">Inactive</label>
                </div>
            </div>

            <div class="buttons">
                <button type="button" class="cancel-button" routerLink="../">Cancel</button>
                <button type="submit" class="save-button" [disabled]="isLoading">
          <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
          {{ isEditing ? 'Update' : 'Create' }} Product
        </button>
            </div>
        </div>
    </form>

    <div class="loading" *ngIf="isLoading">
        <i class="fas fa-spinner fa-spin"></i> {{ isEditing ? 'Loading product...' : 'Creating product...' }}
    </div>
</div>