<div class="container mx-auto p-4">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"></div>
            <p class="mt-4 text-center text-gray-600">Loading settings...</p>
        </div>
    </div>

    <!-- Messages -->
    <div *ngIf="errorMessage" class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
        {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
        {{ successMessage }}
    </div>

    <!-- Settings Navigation -->
    <div class="mb-6">
        <nav class="flex space-x-4" aria-label="Settings sections">
            <button *ngFor="let section of sections" (click)="setActiveSection(section)" [class]="activeSection === section ? 
                      'px-4 py-2 text-sm font-medium text-white bg-primary rounded-md' :
                      'px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 rounded-md hover:bg-gray-100'" [attr.aria-current]="activeSection === section ? 'page' : undefined">
                {{ section | titlecase }}
            </button>
        </nav>
    </div>

    <!-- System Settings -->
    <div *ngIf="activeSection === 'system'" class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold">System Settings</h2>
            <button (click)="resetSection('system')" class="text-gray-600 hover:text-gray-900">
        Reset to Default
      </button>
        </div>

        <form [formGroup]="systemForm" (ngSubmit)="saveSettings('system')" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Company Name</label>
                    <input type="text" formControlName="company_name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="systemForm.get('company_name')?.touched && systemForm.get('company_name')?.invalid" class="mt-1 text-sm text-red-600">
                        Company name is required
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Company Email</label>
                    <input type="email" formControlName="company_email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="systemForm.get('company_email')?.touched && systemForm.get('company_email')?.invalid" class="mt-1 text-sm text-red-600">
                        <div *ngIf="systemForm.get('company_email')?.errors?.['required']">Email is required</div>
                        <div *ngIf="systemForm.get('company_email')?.errors?.['email']">Invalid email format</div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Company Phone</label>
                    <input type="tel" formControlName="company_phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="systemForm.get('company_phone')?.touched && systemForm.get('company_phone')?.invalid" class="mt-1 text-sm text-red-600">
                        Phone number is required
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Timezone</label>
                    <select formControlName="timezone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
            <option *ngFor="let tz of timezones" [value]="tz">{{ tz }}</option>
          </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Date Format</label>
                    <select formControlName="date_format" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
            <option *ngFor="let format of dateFormats" [value]="format">{{ format }}</option>
          </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Currency</label>
                    <select formControlName="currency_format" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
            <option *ngFor="let currency of currencies" [value]="currency.code">
              {{ currency.code }} ({{ currency.symbol }})
            </option>
          </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Default Language</label>
                    <select formControlName="default_language" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
            <option *ngFor="let lang of languages" [value]="lang.code">{{ lang.name }}</option>
          </select>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">Company Address</label>
                    <textarea formControlName="company_address" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50"></textarea>
                    <div *ngIf="systemForm.get('company_address')?.touched && systemForm.get('company_address')?.invalid" class="mt-1 text-sm text-red-600">
                        Address is required
                    </div>
                </div>
            </div>

            <div class="flex justify-end">
                <button type="submit" [disabled]="systemForm.invalid || isLoading" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50">
          Save System Settings
        </button>
            </div>
        </form>
    </div>

    <!-- Email Settings -->
    <div *ngIf="activeSection === 'email'" class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold">Email Settings</h2>
            <div class="space-x-2">
                <button (click)="testEmailSettings()" [disabled]="emailForm.invalid || isLoading" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50">
          Test Email
        </button>
                <button (click)="resetSection('email')" class="text-gray-600 hover:text-gray-900">
          Reset to Default
        </button>
            </div>
        </div>

        <form [formGroup]="emailForm" (ngSubmit)="saveSettings('email')" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">SMTP Host</label>
                    <input type="text" formControlName="smtp_host" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="emailForm.get('smtp_host')?.touched && emailForm.get('smtp_host')?.invalid" class="mt-1 text-sm text-red-600">
                        SMTP host is required
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">SMTP Port</label>
                    <input type="number" formControlName="smtp_port" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="emailForm.get('smtp_port')?.touched && emailForm.get('smtp_port')?.invalid" class="mt-1 text-sm text-red-600">
                        <div *ngIf="emailForm.get('smtp_port')?.errors?.['required']">Port is required</div>
                        <div *ngIf="emailForm.get('smtp_port')?.errors?.['min'] || emailForm.get('smtp_port')?.errors?.['max']">
                            Port must be between 1 and 65535
                        </div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">SMTP Username</label>
                    <input type="text" formControlName="smtp_user" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="emailForm.get('smtp_user')?.touched && emailForm.get('smtp_user')?.invalid" class="mt-1 text-sm text-red-600">
                        Username is required
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">SMTP Password</label>
                    <input type="password" formControlName="smtp_password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="emailForm.get('smtp_password')?.touched && emailForm.get('smtp_password')?.invalid" class="mt-1 text-sm text-red-600">
                        Password is required
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">From Email</label>
                    <input type="email" formControlName="from_email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="emailForm.get('from_email')?.touched && emailForm.get('from_email')?.invalid" class="mt-1 text-sm text-red-600">
                        <div *ngIf="emailForm.get('from_email')?.errors?.['required']">From email is required</div>
                        <div *ngIf="emailForm.get('from_email')?.errors?.['email']">Invalid email format</div>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">From Name</label>
                    <input type="text" formControlName="from_name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="emailForm.get('from_name')?.touched && emailForm.get('from_name')?.invalid" class="mt-1 text-sm text-red-600">
                        From name is required
                    </div>
                </div>

                <div class="md:col-span-2">
                    <label class="flex items-center">
            <input type="checkbox" formControlName="enable_ssl"
              class="rounded border-gray-300 text-primary focus:ring-primary">
            <span class="ml-2">Enable SSL/TLS</span>
          </label>
                </div>
            </div>

            <div class="flex justify-end">
                <button type="submit" [disabled]="emailForm.invalid || isLoading" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50">
          Save Email Settings
        </button>
            </div>
        </form>
    </div>

    <!-- Payment Settings -->
    <div *ngIf="activeSection === 'payment'" class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold">Payment Settings</h2>
            <div class="space-x-2">
                <button (click)="testPaymentSettings()" [disabled]="paymentForm.invalid || isLoading" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50">
          Test Payment
        </button>
                <button (click)="resetSection('payment')" class="text-gray-600 hover:text-gray-900">
          Reset to Default
        </button>
            </div>
        </div>

        <form [formGroup]="paymentForm" (ngSubmit)="saveSettings('payment')" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Payment Gateway</label>
                    <select formControlName="gateway" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
            <option value="stripe">Stripe</option>
            <option value="paypal">PayPal</option>
          </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Currency</label>
                    <select formControlName="currency" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
            <option *ngFor="let currency of currencies" [value]="currency.code">
              {{ currency.code }} ({{ currency.symbol }})
            </option>
          </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">API Key</label>
                    <input type="text" formControlName="api_key" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="paymentForm.get('api_key')?.touched && paymentForm.get('api_key')?.invalid" class="mt-1 text-sm text-red-600">
                        API key is required
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Secret Key</label>
                    <input type="password" formControlName="secret_key" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="paymentForm.get('secret_key')?.touched && paymentForm.get('secret_key')?.invalid" class="mt-1 text-sm text-red-600">
                        Secret key is required
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Webhook Secret</label>
                    <input type="password" formControlName="webhook_secret" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                    <div *ngIf="paymentForm.get('webhook_secret')?.touched && paymentForm.get('webhook_secret')?.invalid" class="mt-1 text-sm text-red-600">
                        Webhook secret is required
                    </div>
                </div>

                <div class="md:col-span-2">
                    <label class="flex items-center">
            <input type="checkbox" formControlName="live_mode"
              class="rounded border-gray-300 text-primary focus:ring-primary">
            <span class="ml-2">Live Mode</span>
          </label>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Payment Methods</label>
                    <div class="space-y-2">
                        <label *ngFor="let method of paymentMethods" class="flex items-center">
                            <input type="checkbox" 
                                   [checked]="paymentForm.get('payment_methods')?.value?.includes(method)"
                                   (change)="updatePaymentMethods($event, method)"
                                   class="rounded border-gray-300 text-primary focus:ring-primary">
                            <span class="ml-2">{{ method | titlecase | replace:'_':' ' }}</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="flex justify-end">
                <button type="submit" [disabled]="paymentForm.invalid || isLoading" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50">
          Save Payment Settings
        </button>
            </div>
        </form>
    </div>

    <!-- Notification Settings -->
    <div *ngIf="activeSection === 'notification'" class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold">Notification Settings</h2>
            <button (click)="resetSection('notification')" class="text-gray-600 hover:text-gray-900">
        Reset to Default
      </button>
        </div>

        <form [formGroup]="notificationForm" (ngSubmit)="saveSettings('notification')" class="space-y-6">
            <div class="space-y-4">
                <div class="border-b pb-4">
                    <h3 class="text-lg font-medium mb-2">Notification Channels</h3>
                    <div class="space-y-2">
                        <label class="flex items-center">
              <input type="checkbox" formControlName="enable_email"
                class="rounded border-gray-300 text-primary focus:ring-primary">
              <span class="ml-2">Email Notifications</span>
            </label>
                        <label class="flex items-center">
              <input type="checkbox" formControlName="enable_sms"
                class="rounded border-gray-300 text-primary focus:ring-primary">
              <span class="ml-2">SMS Notifications</span>
            </label>
                        <label class="flex items-center">
              <input type="checkbox" formControlName="enable_push"
                class="rounded border-gray-300 text-primary focus:ring-primary">
              <span class="ml-2">Push Notifications</span>
            </label>
                    </div>
                </div>

                <div>
                    <h3 class="text-lg font-medium mb-2">Notification Events</h3>
                    <div class="space-y-2">
                        <label class="flex items-center">
              <input type="checkbox" formControlName="notify_on_order"
                class="rounded border-gray-300 text-primary focus:ring-primary">
              <span class="ml-2">New Orders</span>
            </label>
                        <label class="flex items-center">
              <input type="checkbox" formControlName="notify_on_low_stock"
                class="rounded border-gray-300 text-primary focus:ring-primary">
              <span class="ml-2">Low Stock Alerts</span>
            </label>
                        <label class="flex items-center">
              <input type="checkbox" formControlName="notify_on_backup"
                class="rounded border-gray-300 text-primary focus:ring-primary">
              <span class="ml-2">Backup Status</span>
            </label>
                    </div>
                </div>
            </div>

            <div class="flex justify-end">
                <button type="submit" [disabled]="notificationForm.invalid || isLoading" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50">
          Save Notification Settings
        </button>
            </div>
        </form>
    </div>

    <!-- Integration Settings -->
    <div *ngIf="activeSection === 'integration'" class="bg-white rounded-lg shadow-md p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-semibold">Integration Settings</h2>
            <button (click)="resetSection('integration')" class="text-gray-600 hover:text-gray-900">
        Reset to Default
      </button>
        </div>

        <form [formGroup]="integrationForm" (ngSubmit)="saveSettings('integration')" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700">SMS Provider</label>
                    <input type="text" formControlName="sms_provider" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">SMS API Key</label>
                    <input type="password" formControlName="sms_api_key" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Google Maps API Key</label>
                    <input type="password" formControlName="google_maps_key" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700">Google Analytics ID</label>
                    <input type="text" formControlName="analytics_id" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50">
                </div>
            </div>

            <div class="flex justify-end">
                <button type="submit" [disabled]="integrationForm.invalid || isLoading" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 disabled:opacity-50">
          Save Integration Settings
        </button>
            </div>
        </form>
    </div>
</div>