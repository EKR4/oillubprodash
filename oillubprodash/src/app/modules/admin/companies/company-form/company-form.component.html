<div class="container mx-auto p-4">
    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
    </div>

    <!-- Messages -->
    <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4">
        {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4">
        {{ successMessage }}
    </div>

    <!-- Form Header -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold">{{ isEditMode ? 'Edit' : 'New' }} Company</h1>
        <button (click)="navigateToCompanies()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
      Cancel
    </button>
    </div>

    <!-- Company Form -->
    <form [formGroup]="companyForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <!-- Basic Information -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Basic Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Company Name -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Company Name *</label>
                    <input type="text" formControlName="name" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('name') }}</p>
                </div>

                <!-- Business Registration Number -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Registration Number *</label>
                    <input type="text" formControlName="business_registration_number" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('business_registration_number') }}</p>
                </div>

                <!-- Tax ID -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Tax ID</label>
                    <input type="text" formControlName="tax_id" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('tax_id') }}</p>
                </div>

                <!-- Company Type -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Company Type *</label>
                    <select formControlName="company_type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option *ngFor="let type of companyTypes" [value]="type">
              {{ getCompanyTypeLabel(type) }}
            </option>
          </select>
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('company_type') }}</p>
                </div>

                <!-- Industry -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Industry</label>
                    <select formControlName="industry" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option value="">Select Industry</option>
            <option *ngFor="let industry of industries" [value]="industry">
              {{ industry }}
            </option>
          </select>
                </div>

                <!-- Year Established -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Year Established</label>
                    <input type="number" formControlName="year_established" [max]="currentYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- Website -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Website</label>
                    <input type="url" formControlName="website" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('website') }}</p>
                </div>

                <!-- Logo URL -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Logo URL</label>
                    <input type="url" formControlName="logo_url" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
            </div>

            <!-- Description -->
            <div class="mt-4">
                <label class="block text-sm font-medium text-gray-700">Description</label>
                <textarea formControlName="description" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('description') }}</p>
            </div>
        </div>

        <!-- Contact Information -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Contact Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Email -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Email *</label>
                    <input type="email" formControlName="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('email') }}</p>
                </div>

                <!-- Phone -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Phone *</label>
                    <input type="tel" formControlName="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('phone') }}</p>
                </div>

                <!-- Alternative Phone -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Alternative Phone</label>
                    <input type="tel" formControlName="alternative_phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('alternative_phone') }}</p>
                </div>
            </div>
        </div>

        <!-- Address -->
        <div class="bg-white p-6 rounded-lg shadow" formGroupName="primary_address">
            <h2 class="text-xl font-semibold mb-4">Primary Address</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Street -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Street *</label>
                    <input type="text" formControlName="street" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getAddressErrorMessage('street') }}</p>
                </div>

                <!-- City -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">City *</label>
                    <input type="text" formControlName="city" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getAddressErrorMessage('city') }}</p>
                </div>

                <!-- State -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">State/Province</label>
                    <input type="text" formControlName="state" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- Postal Code -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Postal Code *</label>
                    <input type="text" formControlName="postal_code" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getAddressErrorMessage('postal_code') }}</p>
                </div>

                <!-- Country -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Country *</label>
                    <input type="text" formControlName="country" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getAddressErrorMessage('country') }}</p>
                </div>
            </div>
        </div>

        <!-- Company Settings -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Company Settings</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Status -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Status</label>
                    <select formControlName="status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option *ngFor="let status of statuses" [value]="status">
              {{ getStatusLabel(status) }}
            </option>
          </select>
                </div>

                <!-- Verification Status -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Verification Status</label>
                    <select formControlName="verification_status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option *ngFor="let status of verificationStatuses" [value]="status">
              {{ status | titlecase }}
            </option>
          </select>
                </div>

                <!-- Credit Status -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Credit Status</label>
                    <select formControlName="credit_status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
            <option *ngFor="let status of creditStatuses" [value]="status">
              {{ status | titlecase }}
            </option>
          </select>
                </div>

                <!-- Credit Limit -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Credit Limit</label>
                    <input type="number" formControlName="credit_limit" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('credit_limit') }}</p>
                </div>

                <!-- Payment Terms -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Payment Terms</label>
                    <input type="text" formControlName="payment_terms" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>

                <!-- Discount Rate -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">Discount Rate (%)</label>
                    <input type="number" formControlName="discount_rate" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-sm text-red-600">{{ getErrorMessage('discount_rate') }}</p>
                </div>

                <!-- Verified -->
                <div class="flex items-center">
                    <input type="checkbox" formControlName="verified" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label class="ml-2 block text-sm text-gray-900">Verified Company</label>
                </div>
            </div>
        </div>

        <!-- Notes -->
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">Additional Notes</h2>
            <div>
                <textarea formControlName="notes" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="Enter any additional notes about the company..."></textarea>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-end space-x-4">
            <button type="button" (click)="navigateToCompanies()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">
        Cancel
      </button>
            <button type="submit" [disabled]="isLoading" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600 disabled:bg-blue-300">
        {{ isEditMode ? 'Update' : 'Create' }} Company
      </button>
        </div>
    </form>
</div>